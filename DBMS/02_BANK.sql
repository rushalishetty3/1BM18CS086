CREATE DATABASE BANK;
USE BANK;

CREATE TABLE BRANCH(BRANCH_NAME VARCHAR(10), BRANCH_CITY VARCHAR(10), ASSESTS REAL,PRIMARY KEY (BRANCH_NAME));

CREATE TABLE ACCOUNTS(ACC_NO INT(5),BRANCH_NAME VARCHAR(10),BALANCE REAL,PRIMARY KEY(ACC_NO), FOREIGN KEY(BRANCH_NAME) REFERENCES BRANCH(BRANCH_NAME));

CREATE TABLE CUSTOMER(CUSTOMER_NAME VARCHAR(10), CUSTOMER_STREET VARCHAR(10),CUSTOMER_CITY VARCHAR(10),PRIMARY KEY(CUSTOMER_NAME));

CREATE TABLE LOAN(LOAN_NO INT(5),BRANCH_NAME VARCHAR(10), AMOUNT REAL,PRIMARY KEY(LOAN_NO),FOREIGN KEY (BRANCH_NAME) REFERENCES BRANCH(BRANCH_NAME));

CREATE TABLE DEPOSITOR(CUSTOMER_NAME VARCHAR(10),ACC_NO INT(5),PRIMARY KEY (CUSTOMER_NAME,ACC_NO),FOREIGN KEY (CUSTOMER_NAME) REFERENCES CUSTOMER(CUSTOMER_NAME),FOREIGN KEY (ACC_NO) REFERENCES ACCOUNTS(ACC_NO) ON DELETE CASCADE);

INSERT INTO BRANCH VALUES('VIJAYNAGAR','BLORE',200000);
INSERT INTO BRANCH VALUES('SALT LAKE','KOLKATA',30000);
INSERT INTO BRANCH VALUES('HOSKERALLI','BLORE',190222);
INSERT INTO BRANCH VALUES('AGRAHARA','MYSORE',123436);
INSERT INTO BRANCH VALUES('FASER TOWN','BLORE',2314522);
SELECT * FROM BRANCH;

INSERT INTO ACCOUNTS VALUES(1234,'FASER TOWN',200000);
INSERT INTO ACCOUNTS VALUES(2314,'VIJAYNAGAR',39022);
INSERT INTO ACCOUNTS VALUES(4321,'FASER TOWN',23155);
INSERT INTO ACCOUNTS VALUES(4536,'SALT LAKE',67342);
INSERT INTO ACCOUNTS VALUES(1431,'AGRAHARA',23146);
INSERT INTO ACCOUNTS VALUES(1432,'HOSKERALLI',2146);
SELECT * FROM ACCOUNTS;

INSERT INTO CUSTOMER VALUES('SAM','FASER TOWN','BLORE');
INSERT INTO CUSTOMER VALUES('RAJATH','AGRAHARA','MYSORE');
INSERT INTO CUSTOMER VALUES('SHAAN','VIJAYNAGAR','BLORE');
INSERT INTO CUSTOMER VALUES('SAKSHI','SALT LAKE','KOLKATA');
INSERT INTO CUSTOMER VALUES('TANYA','HOSKERALLI','BLORE');
SELECT * FROM CUSTOMER;

INSERT INTO DEPOSITOR VALUES('SAKSHI',1431);
INSERT INTO DEPOSITOR VALUES('SAM',1234);
INSERT INTO DEPOSITOR VALUES('SAM',2314);
INSERT INTO DEPOSITOR VALUES('SAM',4321);
INSERT INTO DEPOSITOR VALUES('SHAAN',4536);
INSERT INTO DEPOSITOR VALUES('SAM',1432);
SELECT * FROM DEPOSITOR;

INSERT INTO LOAN VALUES(2341,'HOSKERALLI',23145);
INSERT INTO LOAN VALUES(3428,'AGRAHARA',34527);
INSERT INTO LOAN VALUES(3526,'FASER TOWN',23145);
INSERT INTO LOAN VALUES(874,'FASER TOWN',23417);
INSERT INTO LOAN VALUES(8453,'SALT LAKE',23190);
SELECT * FROM LOAN;

/*Find Find all the customers who have at least two deposits at the same branch (Ex. ‘SBI_ResidencyRoad’)*/
SELECT DISTINCT D.CUSTOMER_NAME FROM DEPOSITOR D,BRANCH B,ACCOUNTS A WHERE A.ACC_NO=D.ACC_NO AND B.BRANCH_NAME=A.BRANCH_NAME AND B.BRANCH_NAME="FASER TOWN" AND ( SELECT A.ACC_NO FROM ACCOUNTS A HAVING COUNT(*)>=2);

/*Find all the customers who have an account at all the branches located in a specific city (Ex. Delhi).*/
/*no*/
SELECT C.CUSTOMER_NAME FROM CUSTOMER C WHERE NOT EXISTS (SELECT BRANCH_NAME FROM BRANCH WHERE BRANCH_CITY="BLORE" AND BRANCH_NAME NOT IN (SELECT A.BRANCH_NAME FROM DEPOSITOR D,ACCOUNTS A WHERE A.ACC_NO=D.ACC_NO AND C.CUSTOMER_NAME=D.CUSTOMER_NAME));                 
SELECT D.CUSTOMER_NAME FROM DEPOSITOR D WHERE D.ACC_NO=ALL(SELECT A.ACC_NO FROM BRANCH B,ACCOUNTS A WHERE B.BRANCH_CITY="MYSORE" AND A.BRANCH_NAME=B.BRANCH_NAME);

/*Demonstrate how you delete all account tuples at every branch located in a specific city (Ex. Bomay).*/
DELETE FROM ACCOUNTS WHERE BRANCH_NAME IN(SELECT BRANCH_NAME FROM BRANCH WHERE BRANCH_CITY="BLORE");
SELECT * FROM ACCOUNTS;

/*LIST THE ENTIRE LOAN RELATION IN THE DESCENDING ORDER OF AMOUNT*/
SELECT * FROM LOAN ORDER BY AMOUNT DESC;

/*CREATE A VIEW WHICH GIVES EACH BRANCH THE SUM OF THE AMOUNT OF ALL THE LOANS AT THE BRANCH.*/
CREATE VIEW SUM_AMT(BRANCH_NAME,AMOUNT) AS SELECT BRANCH_NAME,SUM(AMOUNT) FROM LOAN GROUP BY BRANCH_NAME;
SELECT * FROM SUM_AMT;

/*THE ANNUAL INTEREST PAYMENTS ARE MADE AND ALL BRANCHES ARE TO BE INCREASED BY 5%.*/
UPDATE ACCOUNTS SET BALANCE=BALANCE*1.05;
SELECT * FROM ACCOUNTS;