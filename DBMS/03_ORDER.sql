CREATE DATABASE ORDER_PROCESSING;
USE ORDER_PROCESSING;

CREATE TABLE CUSTOMERS(CUST_NO INT(3),CNAME VARCHAR(10),CITY VARCHAR(20),PRIMARY KEY(CUST_NO));

CREATE TABLE ORDERS(ORDER_NO INT(3),O_DATE DATE,CUST_NO INT(3),ORD_AMT REAL,PRIMARY KEY(ORDER_NO),FOREIGN KEY(CUST_NO) REFERENCES CUSTOMERS(CUST_NO));

CREATE TABLE ITEM(ITEM_NO INT(3),UNIT_PRICE REAL,PRIMARY KEY(ITEM_NO));

CREATE TABLE ORDER_ITEM(ORDER_NO INT(3),ITEM_NO INT(3),QTY INT(3),FOREIGN KEY(ORDER_NO) REFERENCES ORDERS(ORDER_NO),FOREIGN KEY(ITEM_NO) REFERENCES ITEM(ITEM_NO) ON DELETE SET NULL);

CREATE TABLE WAREHOUSE(WAREHOUSE_NO INT(3), CITY VARCHAR(20),PRIMARY KEY(WAREHOUSE_NO));

CREATE TABLE SHIPMENT(ORDER_NO INT(3),WAREHOUSE_NO INT(3),SHIP_DATE DATE,FOREIGN KEY(ORDER_NO) REFERENCES ORDERS(ORDER_NO),FOREIGN KEY(WAREHOUSE_NO) REFERENCES WAREHOUSE(WAREHOUSE_NO));

INSERT INTO CUSTOMERS VALUES(111,'SAM','BLORE');
INSERT INTO CUSTOMERS VALUES(222,'SHAAN','COORG');
INSERT INTO CUSTOMERS VALUES(333,'SAKSHI','KOLKATA');
INSERT INTO CUSTOMERS VALUES(444,'TANYA','DELHI');
INSERT INTO CUSTOMERS VALUES(555,'AYMAN','MUMBAI');

INSERT INTO ORDERS VALUES(100,'01-01-02',222,16242);
INSERT INTO ORDERS VALUES(200,'03-09-03',111,24930);
INSERT INTO ORDERS VALUES(300,'04-05-09',555,24177);
INSERT INTO ORDERS VALUES(400,'09-12-06',444,123426);
INSERT INTO ORDERS VALUES(500,'01-02-03',333,34526);
INSERT INTO ORDERS VALUES(600,'01-01-01',444,12321);

INSERT INTO ITEM VALUES(10,500);
INSERT INTO ITEM VALUES(20,600);
INSERT INTO ITEM VALUES(30,100);
INSERT INTO ITEM VALUES(40,1000);
INSERT INTO ITEM VALUES(50,200);

INSERT INTO ORDER_ITEM VALUES(200,10,55);
INSERT INTO ORDER_ITEM VALUES(100,10,40);
INSERT INTO ORDER_ITEM VALUES(400,20,13);
INSERT INTO ORDER_ITEM VALUES(300,40,22);
INSERT INTO ORDER_ITEM VALUES(500,30,199);

INSERT INTO WAREHOUSE VALUES(1,"BLORE");
INSERT INTO WAREHOUSE VALUES(2,"KOLKATA");
INSERT INTO WAREHOUSE VALUES(3,"BLORE");
INSERT INTO WAREHOUSE VALUES(4,"DELHI");
INSERT INTO WAREHOUSE VALUES(5,"BLORE");

INSERT INTO SHIPMENT VALUES(100,5,"02-02-02");
INSERT INTO SHIPMENT VALUES(200,4,"03-10-03");
INSERT INTO SHIPMENT VALUES(300,3,"04-06-09");
INSERT INTO SHIPMENT VALUES(200,2,"10-01-07");
INSERT INTO SHIPMENT VALUES(500,3,"01-10-03");

SELECT C.CNAME, COUNT(*) AS NO_OF_ORDER,AVG(O.ORD_AMT) FROM CUSTOMERS C,ORDERS O WHERE C.CUST_NO=O.CUST_NO GROUP BY(O.CUST_NO);

SELECT S.ORDER_NO,W.CITY FROM SHIPMENT S,WAREHOUSE W WHERE S.WAREHOUSE_NO=W.WAREHOUSE_NO AND W.CITY="BLORE";

ALTER TABLE ORDER_ITEM ADD CONSTRAINT FOREIGN KEY(ITEM_NO) REFERENCES ITEM(ITEM_NO) ON DELETE SET NULL;
DELETE FROM ITEM WHERE ITEM_NO=10;
SELECT * FROM ITEM;
SELECT * FROM ORDER_ITEM;

DROP TABLE ORDER_ITEM;